<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> -->
    <!-- 上一条代码IE=edge告诉IE使用最新的引擎渲染网页，chrome=1则可以激活Chrome Frame. -->
    <!-- https://blog.csdn.net/oJingZhiYuan12/article/details/88015130 -->
    <!-- 不过现在都什么年代了，IE我们就别考虑了吧，哈哈哈。 -->

    <title>syntax-tree-parser</title>

    <link href="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
    <!-- <link href="css/style.css" rel="stylesheet" type="text/css"> -->
    <style type="text/css">
        body{background: #eee;}
        .container.main{background: #fff;}
        #the_box,#the_cfg_box{min-height: 80vh;}
        .span-nav-desc{font-size: 0.6em;}
        #the_rules{font-family: "SourceCodePro","Courier New","Courier","Console"}
    </style>

</head>

<body>

    <nav class="navbar navbar-expand-lg navbar-dark bg-dark">
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#the_navbar_toggler" aria-controls="the_navbar_toggler" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="the_navbar_toggler">
        <a class="navbar-brand" href="#">syntax-tree-parser</a>
        <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
          <li class="nav-item active" id="tab-datas">
            <a class="nav-link" href="#">立即使用<span class="span-nav-desc"> (当前为样例)</span></a>
          </li>
          <li class="nav-item">
            <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">选项<span class="span-nav-desc"> (暂未开放)</span></a>
          </li>
        </ul>
        <ul class="navbar-nav mt-2 mt-lg-0">
          <li class="nav-item" id="tab-about">
            <a class="nav-link" href="#">关于</a>
          </li>
        </ul><!-- 
        <form class="form-inline my-2 my-lg-0">
          <input class="form-control mr-sm-2" type="search" placeholder="Search" aria-label="Search">
          <button class="btn btn-outline-success my-2 my-sm-0" type="submit">Search</button>
        </form> -->
      </div>
    </nav>



    <div class="container my-5 py-5 main" id="the_box">
        <div class="row"><div class="col-12"><h4>填写</h4></div></div>
        <div class="row">
            <div class="col">
                <form name="the_form" class="container">
                    <div class="form-group row">
                        <label for="the_text" class="col-sm-2 col-form-label">树表达式</label>
                        <div class="col-sm-10">
                            <!-- <input type="text" class="form-control" name="the_text" id="the_text" value="S[S1_SR[1Thead_n[1T[_1[一],te[十]],_n[_u[九]]],wa[万],Rr[_u[六]]]]"> -->
                            <textarea type="textarea" class="form-control" name="the_text" id="the_text" rows="3">决策树1[C有空缺[A是空缺原文[Q有选项，A是选项之一[多选式完形填空],Q为空[生成式完形填空]]],C无空缺[Q有空缺，A是空缺原文。[Q有选项，A是选项之一[多选式完形填空],Q无选项[生成式完形填空]],Q有选项，A是选项之一[多选],Q仅题干[Q独立[A为C的片段[片段抽取],A自由[自由作答/生成式]],Q在序列中，X提供对话历史[A为C的片段[对话式片段抽取],A自由[对话式自由作答/对话+生成式]]]]]
决策树2：得A需要[仅查C中一串[未分类],查C中多处[C是单文档[未分类],C是多文档集合[多文档/多跳式]],C和X中的K[基于知识,K是文本型[基于知识],K是程序操作[离散推理]]]
决策树3[X为空[未分类],X提供外部知识K[基于知识,K是文本型[基于知识],K是程序操作[离散推理]],X提供对话历史H[对话式],X提供K和H[基于知识对话式]]
决策树4：响应R[仅可能是A[未分类],A或无法回答[含有无法回答的问题]]
决策树5[C是单文档[未分类],C是多文档集合[多文档/多跳式]]
dj:主谓{  np:单词(n) , vp:述宾[  vp:单词(v) , np:单词(n)  ]  }
{dj:主谓{  np:单词(n) , np:粘合定中[  vp:单词(v) , n  ]  }}
[np:定中{  np:单词(n) , np:粘合定中[  vp:单词(v) , n  ]  }]
(np:联合{  np:单词(n) , np:粘合定中[  vp:单词(v) , n  ]  });
vp:状中{  np:单词(n) , vp:述宾[  vp:单词(v) , np:单词(n)  ]  
[vp:述宾{  vp:状中[  np:单词(n) , vp:单词(v)  ] , np:单词(n)  }
dj:存在{  np:单词(n) , vp:单词(v) , np:单词(n)  };np:粘合定中{  vp:状中[  np:单词(n) , vp:单词(v)  ] , n  }
dj:主谓{  np:粘合定中[  n , v  ] ,,, np:单词(n)  }
np:定中{  np:粘合定中[  n , v  ] , np:单词(n)  }]]]]]


np:联合{  np:粘合定中[  n , v  ] , np:单词(n)  }</textarea>
                        </div>
                    </div>
                    <button type="button" name="the_submit_btn" id="the_submit_btn" class="btn btn-primary">画出来！</button>
                    <button type="button" name="the_cleaning_btn" id="the_cleaning_btn" class="btn btn-info">清空</button>
                </form>
            </div>
        </div>
        <hr />
        <div class="row mt-5 mb-3"><div class="col"><h4>出图</h4></div></div>
        <div class="row">
            <div class="col-12">
                <div id="the_svg_wrap"></div>
            </div>
        </div>
    </div>



    <div class="container my-5 py-5 main" id="the_cfg_box">
        <div class="row"><div class="col-12"><h4>填写</h4></div></div>
        <div class="row">
            <div class="col">
                <form name="the_cfg_form" class="container">
                    <div class="form-group row">
                        <label for="the_rules" class="col-sm-2 col-form-label">规则集</label>
                        <div class="col-sm-10">
                            <textarea type="textarea" class="form-control" name="the_rules" id="the_rules" rows="3">d -> 一;
d -> 二;
d -> 三;
d -> 四;
d -> 五;
d -> 六;
d -> 七;
d -> 八;
d -> 九;
d -> 两;
w -> 十;
w -> 百;
w -> 千;
w -> 万;
w -> 亿;
z -> 零;
T -> 十
D -> d
L -> N z;
N -> D w;
N -> N d;
N -> N w;
N -> L d;
N -> T d;
S -> N;

</textarea>
                        </div>
                    </div>
                    <div class="form-group row">
                        <label for="the_tests" class="col-sm-2 col-form-label">句子集</label>
                        <div class="col-sm-10">
                            <textarea type="textarea" class="form-control" name="the_tests" id="the_tests" rows="3">十 一 万 二
五 亿 零 三 百 二
三 万 八
三 万 八 千
四 万 万
四 万 万 五 千 万
四 万 万 五 千 八 百 零 三 万
四 万 万 五 千 八 百 零 三 万 六 千 零 五 十 五
四 万 万 亿
五 千 万 亿

三 百 零 五 亿 七 千 万 零 六 百 二 十 三
四 万 万 三 千 万
两 亿 四 千 五 百 万 零 两 百 八
两 百 八 十 二
五 十 万
三 百 零 二 万
一 万 三 千
一 万 三 千 五 百
十 八 万
三 百 二 十 万


九 十 五 亿 三 千 七 百 八 十 六 万 五 千 四 百 四 十
九 千 九 百 九 十 九 万 九 千 九 百 九 十 九 亿 九 千 九 百 九 十 九 万 九 千 九 百 九 十 九
零 八 十 二
八 百 二 十 零
八 千 零 五 百
三 百 零 二 十 五 万 三 千
三 百 二 十 五 万 零 四 千 亿
两 十
两 十 三
三 十 两 万
一 万 两
三 百 零 两
五 十 百
五 十 千
十 八 千
十 八 百
三 百 二 万
六 千 五 亿
三 万 五 十 亿
百 二
百 六 十
千 五 十 一
万 八 千 六 百 零 一
八 六 百
三 二 万
三 百 万 二
五 十 万 五
八 百 万 二
六 千 万 八
五 百 六 十 万 二
三 百 亿 六
三 百 八 万
六 千 七 亿
五 万 六 亿
五 万 零 七 百 二 亿
五 千 三 百 五 十 万 零 三 百 八 亿
五 十 二 万 四 千 万
三 百 万 五 万 五
三 亿 五 百
六 千 亿 二 十
十 八 万 三 十 六
六 千 五 亿 三 千 万
二 十 八 万 六 亿
二 千 三 百 五 十 万 三 千 零 一 万
</textarea>
                        </div>
                    </div>
                    <button type="button" name="the_cfg_submit_btn" id="the_cfg_submit_btn" class="btn btn-primary">画出来！</button>
                    <button type="button" name="the_cfg_cleaning_btn" id="the_cfg_cleaning_btn" class="btn btn-info">清空</button>
                </form>
            </div>
        </div>
        <hr />
        <div class="row mt-5 mb-3"><div class="col"><h4>出图</h4></div></div>
        <div class="row">
            <div class="col-12">
                <div id="the_cfg_svg_wrap"></div>
            </div>
        </div>
    </div>



    <footer class="pt-4 pb-2 bg-dark text-white">
      <div class="container text-center">
        <p>Github: <a href="https://github.com/gitforziio/syntax-tree-parser" target="_blank">@gitforziio/syntax-tree-parser</a></p>
      </div>
    </footer>


    <script src="https://cdn.bootcss.com/jquery/3.4.1/jquery.min.js"></script>
    <script src="https://cdn.bootcss.com/twitter-bootstrap/4.3.1/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.bootcss.com/d3/5.12.0/d3.min.js"></script>

    <script type="text/javascript" src="js/cfgParser.js"></script>
    <script type="text/javascript" src="js/main.js"></script>

    <script type="text/javascript">
        d3.select("#the_cfg_submit_btn").on("click",()=>{
            let v = d3.select("#the_rules").node().value;
            let rs = rules(v);
            rs.forEach((r,i)=>{
                let p = rulePrinter(r)
                d3.select('#the_cfg_svg_wrap').append('p').text(`【${i+1}】【${p}】`);
                // try {
                //     drawTree('#the_svg_wrap',treeParser(t));
                // } catch(e) {
                //     console.log(e);//throw(e);
                //     d3.select('#the_svg_wrap').append('p').text("error");
                // }
            });
        });
        d3.select("#the_cfg_cleaning_btn").on("click",()=>{
            d3.selectAll('#the_cfg_svg_wrap *').remove();
        })
    </script>

    <script type="text/javascript">
        const tw = 64;
        d3.select("#the_submit_btn").on("click",()=>{
            l = d3.select("#the_text").node().value.split(/[\n;]+/);
            console.log(l);
            l.forEach((t,i)=>{
                d3.select('#the_svg_wrap').append('p').text(`【${i+1}】【${t}】`);
                t = treeFormater(t);
                d3.select('#the_svg_wrap').append('p').text(`【${t}】`);
                try {
                    drawTree('#the_svg_wrap',treeParser(t));
                } catch(e) {
                    console.log(e);//throw(e);
                    d3.select('#the_svg_wrap').append('p').text("error");
                }
            });
            d3.selectAll("#the_svg_wrap svg text").nodes()
                .forEach(e=>{
                    let w = e.getBBox().width;// 【Firefox SVG getBBox方法返回'NS_ERROR_FAILURE'错误分析】 https://www.cnblogs.com/jaxu/p/4193456.html
                    console.log(w);
                    d3.select(e)
                        .attr("textLength", d=>{return w>tw?tw:null})
                        .attr("lengthAdjust", d=>{return w>tw?"spacingAndGlyphs":"spacing"})
                        ;
                });
        });
        d3.select("#the_cleaning_btn").on("click",()=>{
            d3.selectAll('#the_svg_wrap *').remove();
        })
    </script>

</body>

</html>
